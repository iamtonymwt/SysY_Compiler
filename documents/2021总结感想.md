## 2021总结感想

**——曾经沧海难为水，除却巫山不是云**

​	转眼间，编译课程就要结束了，回顾这一个学期的编译之路，真的是感慨万千。一次次的迭代，一共写了大约6000行的代码，成就感满满。之前写过的最难的程序，也不过是上学期的OO，但那时候三次一个小项目也不过最多仅仅3000行。而编译器，真的是一个大项目，从头到尾，助教仅仅是给了我们设计文档，也不是很详细，更多的细节都需要我们自己去思考、设计。

​	回顾最终的代码，真心感觉是九死一生。从最开始的程序分析、词法分析的不屑一顾，到之后语法分析的初具规模，到之后错误处理的熬夜爆肝，再到超级大boss——代码生成的斩妖除魔，再到代码优化的重见光明。看着我自己亲手生成的中间代码文档，看着我自己生成的mips代码文档，我简直母爱泛滥。将一个c语言程序通过我的努力生成了汇编语言，如果应用在我大二做的cpu上，他是真的可以跑出来结果的。从上到下，编译完成了三大重课的临门一脚，将整个体系串联了起来。

​	看着代码生成的1500行代码，我真心觉得好不容易。我基本上是自己把mips架构设计了一遍。
​	还记得那时一个周六，我下午在图书馆坐着，就干坐着，我知道我现在应该写编译作业，ddl快到了，但是无从下手。助教说要设计中间代码，生成中间代码，输出中间代码，怎么设计？没有参考。助教说要生成mips汇编，还要能够短路，能够读值，能够输出，需要使用那些指令？没人告诉我。函数调用的时候应该生成什么？我的变量怎么分配？mips的内存空间可以使用哪些地方？is-else、while等等的控制流该怎么去处理？寄存器呢，我该什么时候去分配？什么还要优化，是不是要一开始就把架构弄好？常量被取用他的值也要传递，但我是递归下降没法搞啊？函数传参有的是赋值有的是引用，这怎么区别？………………

​	做了一下午，又做了一周日，又做了一个周一，没有进度。同时面对如此多的问题，我不知道如何将他们同时处理。可能这就是工程的难题吧，问题是互相耦合的，有点像鸡生蛋蛋生鸡的问题，很难理出一个完美的拓扑序。而有的时候，最好的破局方法实际上就是直接挑一个点硬做。这就有点像循环体数据流分析的过程，你总得想找一个地方分析，再一圈圈分析，迭代出完美的正确解。总而言之，不放弃。面对着架构无法处理递归程序情况，我对书中的函数栈的作用恍然大悟；当我认识到传参原来开销这么大时，我明白mips使用四个寄存器传参的用意；当我被一次函数调用带来的巨量代码所震惊时，我明白了函数内敛的意义。

​	重新回顾我大一的c语言代码，我的视角早已发生了变化。我会思考函数参数背后的传递机理，我会思考此处的代码实际上完全没必要，gcc会不会帮我自动给删了呢？我会思考可能我写代码时候迷迷糊糊，但实际上编译器才是那个最懂我的人。看到除法，我会心生恐惧，看到while，if-else我更会去寻找控制流。哪怕是那小小的printf，都会勾起我对于.global以及内存架构的回忆。

​	当然，知识本身其实并不重要，这就好比大二我上完计算机组成，那已经觉得这辈子不会再忘mips架构了，但是是过一个月就基本什么细节都不记得了。编译可能也是一样，可能寒假过后，什么错误处理，什么优化我都会记不太清。但是他让我对于代码有了全新的理解，让我对我的能力有了全新的评估，让我熟悉些日志帮助我更好的迭代开发，帮助我第一次主动使用github进行版本控制，帮助我明白，原来简简单单的c语言，一句"hello word"背后要有这么多的工作，原来以前的计算机科学家面对的科研是如此的富有挑战性，原来理论真的可以指导实践，原来书上的东西真的可以落实成代码。

​	而近两周时间的代码优化经历又告诉我，当我们面对困难，急需提高的时候，其实改进自己原有的问题时更加务实的，不要对于自身的问题有惧怕心理，懒惰情绪，要学会勇敢面对。当我优化不动时，总幻想着能不能找一个更先进的优化方法一飞冲天。可之后才发现，仅仅是把自己原有的冗余代码优化掉就可以前进一大步，从自己身上寻找问题，才是捷径。当然，优化就意味着debug，并且是cpp，c，midcode，mipscode的多线程互看，体验非常糟糕。

​	总而言之，本学期的编译课体验不错，感谢助教和老师们的陪伴与付出。当然，下面还有一些建议。

#### 建议

* 首先是优化部分，我认为或者可以缩短时间，减少恶性竞争与边界效应；或者可以设定一个阈值，过了线即拿到大部分分数。（当然这也会让课程在知乎少一些口诛笔伐）
* 其次是理论部分，令人惊诧的是居然老师和助教从始至终没有给出来过具体的考点范围，这使得复习范围很大，且重点不够明显
* 最后是上机课的时间其实可以组织同学们互相交流展示，以换取平时分，这样也能答疑解惑一下，毕竟助教们都很久不写编译，对于mips体系不是很熟

